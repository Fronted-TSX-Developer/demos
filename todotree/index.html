<!DOCTYPE html><html><head><style>html {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
}

#root {
  border-radius: 1rem;
  padding: 1rem;
}

.PageTodoList .layout .todo {
  width: 100%;
}

.PageTodoList .layout .todo .ant-space-item:nth-child(1) {
  flex-grow: 1;
}</style>
		 <script>var __VAR_JSON__ = {
  "name": "o(*≧▽≦)ツ┏━┓",
  "dependencies": {
    "react": "https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js",
    "react-dom": "https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js",
    "moment": "https://cdn.jsdelivr.net/npm/moment/moment.js",
    "antd": "https://cdn.jsdelivr.net/npm/antd/dist/antd.min.js",
    "@ant-design/icons": "https://cdn.jsdelivr.net/npm/@ant-design/icons/dist/index.umd.js"
  },
  "types": {
    "react": "https://cdn.jsdelivr.net/npm/@types/react/index.d.ts",
    "react-dom": "https://cdn.jsdelivr.net/npm/@types/react-dom/index.d.ts",
    "csstype": "https://cdn.jsdelivr.net/npm/csstype/index.d.ts",
    "prop-types": "https://cdn.jsdelivr.net/npm/@types/prop-types/index.d.ts",
    "moment": "https://cdn.jsdelivr.net/npm/moment/moment.d.ts",
    "antd": "https://cdn.jsdelivr.net/npm/antd/lib/index.d.ts",
    "@ant-design/icons": "https://cdn.jsdelivr.net/npm/@ant-design/icons/lib/icons/index.d.ts"
  }
};</script>
		 <!-- for typescript target: AMD -->
<script src="https://cdn.bootcss.com/require.js/2.3.6/require.min.js"></script>

<!-- antd stylesheet -->
<link href="https://unpkg.com/antd@4.16.1/dist/antd.min.css" rel="stylesheet">

</head><body><div id="root"></div>

		 <script>;(function(){
	// 1. config requirejs
const packages = __VAR_JSON__.dependencies
const oldLoad = requirejs.load
requirejs.load = function (context, id, url) {
  if (id in packages) {
    url = packages[id]
  }
  return oldLoad.call(requirejs, context, id, url)
}

// 2. declarations config
// please remove it before sandbox exports.
// api docs:https://github.com/Saber2pr/editor/blob/master/docs/script.md
if (top !== self) {
  if (!top._finished && top.monaco) {
    top.LOADING.init()
    const typescriptVersion = top.monaco.languages.typescript.typescriptVersion
    console.log(`[<span style="color:blue;">Typescript Version:${typescriptVersion}</span>]`)
    console.log('--- wait for types fetching... ---')
    const info = m => `<span style="background:lightskyblue">${m}</span>`
    const types = __VAR_JSON__.types
    const names = Object.keys(types)
    const count = names.length
    let index = 0
    Promise.all(names.map(name => top.api_addModuleDeclaration(types[name], name)
      .then(() =>
        console.log(`type(${++index}/${count}): ${info(`[${name}]`)} fetched`))))
      .then(() => {
        console.log(`--- types fetching finished. ---`)
        top.LOADING.destroy()
      })
    top._finished = true
  }
}

// 3. enjoy it!
console.log(__VAR_JSON__.name, new Date().toLocaleString())
	})();</script><script>var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spreadArray = (this && this.__spreadArray) || function (to, from) {
    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)
        to[j] = from[i];
    return to;
};
var __values = (this && this.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
define("index",["require", "exports", "antd", "@ant-design/icons", "react", "react-dom"], function (require, exports, antd_1, icons_1, react_1, react_dom_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.PageTodoTree = exports.getArray = exports.treeDrop = exports.clearDoneNode = exports.removeNode = exports.appendNode = exports.findNode = exports.i18n = exports.localeMap = exports.I18n = exports.KEY_TODO_TREE = exports.calcProgressV2 = void 0;
    react_1 = __importStar(react_1);
    react_dom_1 = __importDefault(react_dom_1);
    var calcProgressV2 = function (todos) {
        var sum = 0;
        var doneNum = 0;
        var stack = __spreadArray([], __read(todos));
        while (stack.length) {
            var current = stack.pop();
            if (current.children) {
                stack.push.apply(stack, __spreadArray([], __read(current.children)));
            }
            sum++;
            if (current.todo.done) {
                doneNum++;
            }
        }
        if (sum === 0) {
            return 0;
        }
        return Number(Number((doneNum * 100) / sum).toFixed(0));
    };
    exports.calcProgressV2 = calcProgressV2;
    exports.KEY_TODO_TREE = 'todotree';
    var template = function (tpl, values) {
        return tpl.replace(/{\w+}/g, function (slot) { return values[slot.replace(/{|}/g, '')]; });
    };
    var I18n = (function () {
        function I18n() {
            this.localesTextMap = {};
            this.currentTextMap = {};
        }
        I18n.prototype.registry = function (locale, text) {
            this.localesTextMap[locale] = text;
        };
        I18n.prototype.setLocal = function (locale) {
            this.currentTextMap =
                this.localesTextMap[locale] ||
                    this.localesTextMap[Object.keys(this.localesTextMap)[0]];
        };
        I18n.prototype.format = function (contentKey, args) {
            var i18nformatString = this.currentTextMap[contentKey];
            if (!i18nformatString) {
                return '';
            }
            return args ? template(i18nformatString, args) : i18nformatString;
        };
        return I18n;
    }());
    exports.I18n = I18n;
    exports.localeMap = {
        en: {
            removeItemTip: 'Are you sure to delete this backlog?',
            confirm: 'Ok',
            cancel: 'Cancel',
            newItem: 'New',
            save: 'Save',
            saveTip: 'Save success',
            clearDone: 'Clear completed',
            clearDoneTip: 'Are you sure to clear completed items?',
            update: 'Update List',
            updateTip: 'The update is successful',
        },
        'zh-cn': {
            removeItemTip: '确定删除此待办事项？',
            confirm: '确定',
            cancel: '取消',
            newItem: '新建待办',
            save: '保存内容',
            saveTip: '保存成功',
            clearDone: '清除已完成项',
            clearDoneTip: '确定清除已完成项？',
            update: '更新列表',
            updateTip: '更新成功',
        },
    };
    var i18n = new I18n();
    exports.i18n = i18n;
    i18n.registry('en', exports.localeMap.en);
    i18n.registry('zh-cn', exports.localeMap['zh-cn']);
    i18n.setLocal('zh-cn');
    var findNode = function (treeNode, key) {
        var e_1, _a;
        if (!((treeNode === null || treeNode === void 0 ? void 0 : treeNode.length) > 0))
            return;
        try {
            for (var treeNode_1 = __values(treeNode), treeNode_1_1 = treeNode_1.next(); !treeNode_1_1.done; treeNode_1_1 = treeNode_1.next()) {
                var node = treeNode_1_1.value;
                if (node.key === key)
                    return node;
                return exports.findNode(node.children, key);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (treeNode_1_1 && !treeNode_1_1.done && (_a = treeNode_1.return)) _a.call(treeNode_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    exports.findNode = findNode;
    var appendNode = function (container, node) {
        if (Array.isArray(container)) {
            container.push(node);
        }
    };
    exports.appendNode = appendNode;
    var removeNode = function (container, node) {
        if (Array.isArray(container)) {
            container.splice(container.indexOf(node), 1);
        }
    };
    exports.removeNode = removeNode;
    var clearDoneNode = function (treeNode, isRemove) {
        var e_2, _a;
        if (!((treeNode === null || treeNode === void 0 ? void 0 : treeNode.length) > 0))
            return [];
        var nextTree = [];
        try {
            for (var treeNode_2 = __values(treeNode), treeNode_2_1 = treeNode_2.next(); !treeNode_2_1.done; treeNode_2_1 = treeNode_2.next()) {
                var node = treeNode_2_1.value;
                if (isRemove(node)) {
                    continue;
                }
                nextTree.push(node);
                node.children = exports.clearDoneNode(node.children, isRemove);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (treeNode_2_1 && !treeNode_2_1.done && (_a = treeNode_2.return)) _a.call(treeNode_2);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return nextTree;
    };
    exports.clearDoneNode = clearDoneNode;
    var treeDrop = function (tree, handle) { return function (info) {
        var dropKey = info.node.key;
        var dragKey = info.dragNode.key;
        var dropPos = info.node.pos.split('-');
        var dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]);
        var loop = function (data, key, callback) {
            for (var i = 0; i < data.length; i++) {
                if (data[i].key === key) {
                    return callback(data[i], i, data);
                }
                if (data[i].children) {
                    loop(data[i].children, key, callback);
                }
            }
        };
        var data = __spreadArray([], __read(tree));
        var dragObj;
        loop(data, dragKey, function (item, index, arr) {
            arr.splice(index, 1);
            dragObj = item;
        });
        if (!info.dropToGap) {
            loop(data, dropKey, function (item) {
                item.children = item.children || [];
                item.children.unshift(dragObj);
            });
        }
        else if ((info.node.props.children || []).length > 0 &&
            info.node.props.expanded &&
            dropPosition === 1) {
            loop(data, dropKey, function (item) {
                item.children = item.children || [];
                item.children.unshift(dragObj);
            });
        }
        else {
            var ar_1;
            var i_1;
            loop(data, dropKey, function (item, index, arr) {
                ar_1 = arr;
                i_1 = index;
            });
            if (dropPosition === -1) {
                ar_1.splice(i_1, 0, dragObj);
            }
            else {
                ar_1.splice(i_1 + 1, 0, dragObj);
            }
        }
        handle(data);
    }; };
    exports.treeDrop = treeDrop;
    function getArray(array) { return (Array.isArray(array) ? array : []); }
    exports.getArray = getArray;
    var Text = antd_1.Typography.Text, Title = antd_1.Typography.Title;
    var events = [];
    var PageTodoTree = function () {
        var _a = __read(react_1.useState({}), 2), _ = _a[0], setState = _a[1];
        var forceUpdate = function () { return setState({}); };
        var expandKeysRef = react_1.useRef([]);
        var updateExpandKeys = function (keys, type) {
            if (type === void 0) { type = 'push'; }
            var expandKeys = getArray(expandKeysRef.current);
            expandKeysRef.current = Array.from(new Set(type === 'push' ? __spreadArray(__spreadArray([], __read(expandKeys)), __read(keys)) : keys));
            forceUpdate();
        };
        var treeRef = react_1.useRef([]);
        var updateTree = function () {
            var data = treeRef.current;
            if (Array.isArray(data)) {
                treeRef.current = data.slice();
            }
            forceUpdate();
            events.forEach(function (l) { return l(); });
        };
        var loadSource = function () { return __awaiter(void 0, void 0, void 0, function () {
            var todo, val;
            return __generator(this, function (_a) {
                todo = localStorage.getItem(exports.KEY_TODO_TREE);
                if (todo) {
                    val = JSON.parse(todo);
                    treeRef.current = getArray(val.tree);
                    expandKeysRef.current = getArray(val.expandKeys);
                    forceUpdate();
                }
                return [2];
            });
        }); };
        react_1.useEffect(function () {
            loadSource();
        }, []);
        var Item = function (_a) {
            var node = _a.node;
            var _b = __read(react_1.useState({}), 2), _ = _b[0], setState = _b[1];
            react_1.useEffect(function () {
                var listener = function () { return setState({}); };
                events.push(listener);
                return function () {
                    events = events.filter(function (l) { return l !== listener; });
                };
            }, []);
            var todo = node.todo;
            var ops = react_1.default.createElement(react_1.default.Fragment, null);
            if (todo.done) {
                ops = (react_1.default.createElement(react_1.default.Fragment, null,
                    react_1.default.createElement(antd_1.Button, { size: "small", type: "text", icon: react_1.default.createElement(icons_1.UndoOutlined, null), onClick: function () {
                            todo.done = false;
                            updateTree();
                        } })));
            }
            else {
                ops = (react_1.default.createElement(react_1.default.Fragment, null,
                    react_1.default.createElement(antd_1.Select, { bordered: false, size: "small", value: todo.level, onSelect: function (level) {
                            todo.level = level;
                            updateTree();
                        } },
                        react_1.default.createElement(antd_1.Select.Option, { value: "danger" }, "P0"),
                        react_1.default.createElement(antd_1.Select.Option, { value: "warning" }, "P1"),
                        react_1.default.createElement(antd_1.Select.Option, { value: "success" }, "P2"),
                        react_1.default.createElement(antd_1.Select.Option, { value: "default" }, "P3"),
                        react_1.default.createElement(antd_1.Select.Option, { value: "secondary" }, "P4")),
                    react_1.default.createElement(antd_1.Button, { size: "small", type: "text", icon: react_1.default.createElement(icons_1.PlusOutlined, null), onClick: function () {
                            createNode(function () { return node.children; });
                            updateTree();
                            updateExpandKeys([node.key], 'push');
                        } }),
                    react_1.default.createElement(antd_1.Button, { size: "small", type: "text", icon: react_1.default.createElement(icons_1.CheckOutlined, null), onClick: function () {
                            todo.done = true;
                            updateTree();
                        } }),
                    react_1.default.createElement(antd_1.Popconfirm, { placement: "topLeft", title: i18n.format('removeItemTip'), onConfirm: function () {
                            todo.pendingDelete = true;
                            treeRef.current = exports.clearDoneNode(treeRef.current, function (node) { return node.todo.pendingDelete; });
                            updateTree();
                        }, okText: i18n.format('confirm'), cancelText: i18n.format('cancel') },
                        react_1.default.createElement(antd_1.Button, { size: "small", type: "text", icon: react_1.default.createElement(icons_1.DeleteOutlined, null) }))));
            }
            return (react_1.default.createElement(antd_1.Space, { className: "todo" },
                react_1.default.createElement(Text, { delete: todo.done, type: todo.level === 'default' ? null : todo.level, disabled: todo.done ? true : false, editable: todo.done
                        ? false
                        : {
                            tooltip: false,
                            onChange: function (value) {
                                todo.content = value;
                                updateTree();
                            },
                        } }, todo.content),
                ops));
        };
        var createNode = function (getContainer) {
            var key = Date.now();
            var node = {
                key: key,
                children: [],
                todo: {
                    content: 'edit todo.',
                    id: key,
                    level: 'default',
                    done: false,
                },
                toJSON: function () { return ({
                    key: node.key,
                    children: node.children,
                    todo: node.todo,
                }); },
            };
            exports.appendNode(getContainer(), node);
        };
        var save = function () { return __awaiter(void 0, void 0, void 0, function () {
            var storeVal;
            return __generator(this, function (_a) {
                storeVal = {
                    tree: treeRef.current,
                    expandKeys: expandKeysRef.current,
                };
                localStorage.setItem(exports.KEY_TODO_TREE, JSON.stringify(storeVal));
                return [2];
            });
        }); };
        react_1.useEffect(function () {
            save();
        }, [treeRef.current]);
        var percent = react_1.useMemo(function () { return exports.calcProgressV2(treeRef.current); }, [treeRef.current]);
        return (react_1.default.createElement("div", { className: "PageTodoList" },
            react_1.default.createElement("div", { className: "layout" },
                react_1.default.createElement(antd_1.Space, { direction: "vertical", style: { width: '100%' } },
                    react_1.default.createElement(Title, null, "Todo List"),
                    react_1.default.createElement(antd_1.Progress, { percent: percent })),
                react_1.default.createElement(antd_1.Divider, null),
                react_1.default.createElement(antd_1.Tree, { titleRender: function (node) { return react_1.default.createElement(Item, { node: node }); }, expandedKeys: expandKeysRef.current, onExpand: function (keys) { return updateExpandKeys(keys, 'replace'); }, draggable: true, blockNode: true, onDrop: exports.treeDrop(treeRef.current, function (data) {
                        treeRef.current = data;
                        updateTree();
                    }), treeData: treeRef.current }),
                react_1.default.createElement(antd_1.Divider, null),
                react_1.default.createElement(antd_1.Space, { split: react_1.default.createElement(antd_1.Divider, { type: "vertical" }) },
                    react_1.default.createElement(antd_1.Button, { type: "text", onClick: function () {
                            createNode(function () { return treeRef.current; });
                            updateTree();
                        } }, i18n.format('newItem')),
                    react_1.default.createElement(antd_1.Button, { type: "text", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0: return [4, save()];
                                    case 1:
                                        _a.sent();
                                        antd_1.message.success(i18n.format('saveTip'));
                                        return [2];
                                }
                            });
                        }); } }, i18n.format('save')),
                    react_1.default.createElement(antd_1.Popconfirm, { placement: "top", title: i18n.format('clearDoneTip'), onConfirm: function () {
                            treeRef.current = exports.clearDoneNode(treeRef.current, function (node) { return node.todo.done; });
                            updateTree();
                        }, okText: i18n.format('confirm'), cancelText: i18n.format('cancel') },
                        react_1.default.createElement(antd_1.Button, { type: "text" }, i18n.format('clearDone'))),
                    react_1.default.createElement(antd_1.Button, { type: "text", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0: return [4, loadSource()];
                                    case 1:
                                        _a.sent();
                                        antd_1.message.success(i18n.format('updateTip'));
                                        return [2];
                                }
                            });
                        }); } }, i18n.format('update'))))));
    };
    exports.PageTodoTree = PageTodoTree;
    react_dom_1.default.render(react_1.default.createElement(exports.PageTodoTree, null), document.querySelector('#root'));
});
;require(["index"])</script></body></html>